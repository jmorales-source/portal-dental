<script>
const apiURL = "https://script.google.com/macros/s/AKfycbxqV5vyHN1tQlcTMcFcJ_4CYYW3BJI1kxUP_wRFKHmtkWW2t1h68uvaj91NhROKYQiebw/exec";

async function buscarCasos() {
    const doctorInput = document.getElementById("doctorInput").value.trim();
    const resultadosDiv = document.getElementById("resultados");

    if (doctorInput === "") {
        resultadosDiv.innerHTML = "<div class='mensaje'>Debe ingresar su nombre completo.</div>";
        return;
    }

    resultadosDiv.innerHTML = "<div class='mensaje'>Consultando...</div>";

    try {
        const response = await fetch(`${apiURL}?doctor=${encodeURIComponent(doctorInput)}`);
        const data = await response.json();

        console.log("DATA RECIBIDA:", data);

        if (!data || data.length === 0) {
            resultadosDiv.innerHTML = "<div class='mensaje'>No se encontraron casos.</div>";
            return;
        }

        let html = "";

        data.forEach(item => {

            html += `
                <div class="caso">
                    <div><span class="label">Paciente:</span> ${item.paciente ?? ""}</div>
                    <div><span class="label">Doctor:</span> ${item.doctor ?? ""}</div>
                    <div><span class="label">Fecha de entrega:</span> ${item.fechaEntrega ?? ""}</div>
                    <div><span class="label">Arco Superior:</span> ${item.arcoSuperior ?? ""}</div>
                    <div><span class="label">Arco Inferior:</span> ${item.arcoInferior ?? ""}</div>
                    <div><span class="label">Cantidad de alineadores U/L:</span> ${item.cantidadAlineadores ?? ""}</div>
                    <div><span class="label">Planes:</span> ${item.planes ?? ""}</div>
                    <div><span class="label">Estatus del caso:</span> ${item.estatus ?? ""}</div>
                </div>
            `;
        });

        resultadosDiv.innerHTML = html;

    } catch (error) {
        resultadosDiv.innerHTML = "<div class='mensaje'>Error al conectar con el servidor.</div>";
        console.error(error);
    }
}
</script>
